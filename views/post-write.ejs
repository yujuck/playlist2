<!DOCTYPE html>
<html>

<head>
    <title>모임 글 작성</title>
</head>

<body>
    <div id="app">


            <h1>글 작성</h1>

            <h5>카테고리</h5>
            <select v-model="post.categoryId" ref="categoryid">
                <option value="0" selected>카테고리 선택</option>
                <option v-for="c in category" v-bind:value="c.id">{{c.categoryname}}</option>  <!-- v-bind:value에 서버로 넘겨줄 데이터를 넣어놓자! -->
            </select>

            <h5>제목</h5>
            <input v-model="post.title" ref="title" type="text">

            <h5>인원 제한</h5>
            <input v-model="post.headcount" ref="headcount" type="number">

            <h5>나이대</h5>
            <select v-model="post.age">
                <option v-for="a in age">{{a.age}}</option>
            </select>

            <h5>이력</h5>
            <input v-model="post.record" ref="record" type="text">

            <h5>내용</h5>
            <input v-model="post.content" ref="content" type="text">

            <button v-on:click="savePost">등록</button>

    </div>


    
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        
        var app = new Vue({
            el: '#app',
            data: {
                category: [],
                age: [
                    {id:0, age:'제한없음'},
                    {id:1, age:'10대'},
                    {id:2, age:'20대'},
                    {id:3, age:'30대'},
                    {id:4, age:'40대'},
                    {id:5, age:'50대'}
                ],
                post: {
                    categoryId: '',
                    title: '',
                    headcount: '',
                    age: '',
                    record: '',
                    content: '',
                    participants: 0,
                    good: 0,
                    count: 0,
                    photo: ''
                }

            },
            created: function () {               

                axios.get('/category')
                    .then(function (res) {
                        this.category = res.data;
                    }.bind(this))
                    .catch(function (err) {
                        console.log(err);
                    });

            },
            methods: {
                savePost: function() {

                    if (this.post.categoryId == '') {
                        alert("카테고리를 선택해주세요");
                        this.$refs.categoryid.focus();
                        return false;
                    }

                    if (this.post.title == '') {
                        alert("제목을 입력해주세요");
                        this.$refs.title.focus();
                        return false;
                    }

                    if (this.post.headcount == '') {
                        alert("인원수를 입력해주세요");
                        this.$refs.headcount.focus();
                        return false;
                    }

                    if (this.post.age == '') {
                        alert("나이대를 선택해주세요");
                        this.$refs.age.focus();
                        return false;
                    }

                    if (this.post.record == '') {
                        alert("이력을 입력해주세요");
                        this.$refs.record.focus();
                        return false;
                    }

                    if (this.post.content == '') {
                        alert("내용을 입력해주세요");
                        this.$refs.content.focus();
                        return false;
                    }

                    axios.post('/meetpost/write', this.post) //post 방식으로 넘김
                    .then(function (res) {
                      
                        console.log(res);
                        location.href="/meetpost";
                        
                    }.bind(this))
                    .catch(function(err){

                        console.log(err)
                    });
      
                }
            }
            
        });


    </script>

</body>

</html>