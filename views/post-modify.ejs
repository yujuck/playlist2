<!DOCTYPE html>
<html>

<head>
    <title>모임 글 수정</title>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    
</head>

<body>
    <div id="app">
            <h1>글 수정</h1>

            <h5>카테고리</h5>
            <select v-model="post.categoryId" ref="categoryid">
                <option value="0" selected>카테고리 선택</option>
                <option v-for="c in category" v-bind:value="c.id">{{c.categoryname}}</option>
            </select>

            <h5>제목</h5>
            <input v-model="post.title" ref="title" type="text">

            <h5>인원 제한</h5>
            <input v-model="post.headcount" ref="headcount" type="number">

            <h5>나이대</h5>
            <select v-model="post.age">
                <option v-for="a in age" v-bind:key="age.id">{{a.age}}</option>
            </select>

            <h5>이력</h5>
            <input v-model="post.record" ref="record" type="text">

            <h5>내용</h5>
            <input v-model="post.content" ref="content" type="text">

            <button v-on:click="savePost">등록</button>

    </div>


    
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>

        $.urlParam = function (name) {
            var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
            if (results == null) {
                return null;
            }
            else {
                return results[1] || 0;
            }
        }
        var id = $.urlParam('id');
    
        
        var app = new Vue({
            el: '#app',
            data: {
                category: [],
                age: [
                    {id:0, age:'제한없음'},
                    {id:1, age:'10대'},
                    {id:2, age:'20대'},
                    {id:3, age:'30대'},
                    {id:4, age:'40대'},
                    {id:5, age:'50대'}
                ],
                post: []

            },
            created: function () {               

                axios.get('/category')
                    .then(function (res) {
                        this.category = res.data;
                    }.bind(this))
                    .catch(function (err) {
                        console.log(err);
                    });
                
                    axios.get('/meetpost/' + id + '/modify')
                    .then(function (res) {
                        this.posts = res.data;
                        console.log(this.posts);
                    }.bind(this))
                    .catch(function (err) {
                        console.log(err);
                    });
            },
            methods: {
                savePost: function() {

                    axios.post('/meetpost/write', this.post) //post 방식으로 넘김
                    .then(function (res) {
                      
                        console.log(res);
                        location.href="/meetpost/listpage";
                        
                    }.bind(this))
                    .catch(function(err){

                        console.log(err)
                    });
      
                }
            }
            
        });


    </script>

</body>

</html>